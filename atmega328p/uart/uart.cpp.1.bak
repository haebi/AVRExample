#define F_CPU 16000000UL	// Set CPU Frequency 16 MHz

#define setbit(PORTX, BitX) PORTX |= (1 << BitX)	// set bit to 1
#define clrbit(PORTX, BitX) PORTX &= ~(1 << BitX)	// clear bit

#include <avr/io.h>
#include <avr/interrupt.h>
#include <avr/pgmspace.h>

#include <util/delay.h>

#include <stdio.h>
#include <string.h>

void init_uart();

void send_char(char c)
{
	//while ((UCSR1A & (1 << UDRE1)) == 0) {};
	while((UCSR0A&0x20) == 0);
	UDR0 = c;
}

//void send_string(char s[])
void send_string(char *s)
{
	int i =0;

	while (s[i] != 0x00)
	{
		send_char(s[i]);
		i++;
	}

	//send_char(0x00);
}

// Main Function
int main(void)
{
/*
	char sdata_1[] PROGMEM = "01234k";
	char sdata_2[] PROGMEM = "_ok";

	PGM_P sdata[] PROGMEM = 
	{
		sdata_1,
		sdata_2
	};
*/

	DDRB  = 0xFF; // output
	PORTB = 0x00; // low

	int sys_sec = 0;

	init_uart();

	//_delay_ms(1000);

	while(1)
	{
		//char data[64 +1] = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\n2017.04.24.000001.001 _ok";
		//char data[64 +1] = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\n2017.04.24.000001.001 _ok";

		//char data[64] = "0000";
	
		//strcpy_P(data1, (PGM_P)pgm_read_word(&(sdata[0])));
		//strcpy_P(data, (PGM_P)pgm_read_word(&(sdata[1])));

		//sprintf(data, "[%04d] 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\n[%04d] 2017.04.24.000001.006 _ok", sys_sec, sys_sec);

		//send_string(data);
		
		char data[32] = "ABCDEFG~!!k_ok";
		
		send_string(data);

		sys_sec++;

		// Activity check LED
		// --------------------------------------------------
		PORTB = 0x00; // low
		_delay_ms(1000);

		PORTB = 0xFF; // high
		_delay_ms(1000);
		// --------------------------------------------------
	}
}

// Setting UART
void init_uart()
{
	UCSR0A = 0x00;
	UCSR0B = 0x98;
	UCSR0C = 0x06; // 8bit data
	UBRR0H = 0x01;
	UBRR0L = 0xA0; // 9600 bps

	// Enable Interrupt
	sei();
}

ISR(USART_RX_vect)
{

}

ISR(USART_UDRE_vect)
{

}

